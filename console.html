<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Адмін Консоль — UkrMova PRO</title>
<style>
  body {
    margin:0; padding:20px; background:#000; color:#0f0;
    font-family:'Courier New',monospace; font-size:16px; line-height:1.4;
  }
  h1 { color:#0f0; text-shadow:0 0 10px #0f0; }
  button {
    background:#0a0; color:#000; border:2px solid #0f0;
    padding:8px 16px; margin:6px 2px; font-family:inherit;
    cursor:pointer; min-width:180px;
  }
  button:hover { background:#0f0; color:#000; }
  input, select {
    background:#111; color:#0f0; border:1px solid #0f0;
    padding:6px; margin:4px; font-family:inherit; width:220px;
  }
  pre { white-space:pre-wrap; background:#111; padding:12px;
        border:1px solid #0f0; border-radius:4px; margin:10px 0; }
  #output { min-height:400px; max-height:70vh; overflow-y:auto; }
  .section { margin:20px 0; padding:10px; border:1px dashed #0f0; }
</style>
</head>
<body>

<h1>АДМІН КОНСОЛЬ — UKRMOVA PRO</h1>

<div class="section">
  <h3>Гравці</h3>
  <button onclick="getPlayers()">Список усіх гравців</button>
  <br>
  <input id="nickEdit" placeholder="Нік гравця">
  <button onclick="deletePlayer()">Видалити гравця</button>
  <button onclick="editMoney(true)">+ Гроші</button>
  <button onclick="editMoney(false)">- Гроші</button>
  <button onclick="editLevel()">Змінити рівень</button>
</div>

<div class="section">
  <h3>Чат бота</h3>
  <button onclick="getBotChat()">Показати чат</button>
  <button onclick="clearBotChat()">Очистити чат</button>
</div>

<div class="section">
  <h3>Логи</h3>
  <button onclick="getUserLogs()">Лог входів гравців</button>
  <button onclick="getAdminLogs()">Лог адмін-дій</button>
</div>

<div class="section">
  <h3>Статистика</h3>
  <button onclick="getStats()">Загальна статистика</button>
</div>

<button onclick="clearScreen()" style="background:#800;color:#fff;border-color:#f00">Очистити екран</button>

<div id="output"><pre>Готовий до команд... (оновлено 06.02.2026)</pre></div>

<script>
const DB = "https://ukrmova-game-default-rtdb.europe-west1.firebasedatabase.app/";

async function fetchData(path) {
  try {
    let res = await fetch(DB + path + ".json");
    return await res.json() || {};
  } catch(e) {
    return {error: e.message};
  }
}

function print(text) {
  let out = document.getElementById("output");
  let pre = document.createElement("pre");
  pre.textContent = text;
  out.appendChild(pre);
  out.scrollTop = out.scrollHeight;
}

async function getPlayers() {
  let data = await fetchData("users");
  print("=== УСІ ГРАВЦІ ===");
  if (Object.keys(data).length === 0) return print("Гравців немає");
  for (let uid in data) {
    let u = data[uid];
    print(`Юз: ${uid}\nНік: ${u.name||'—'}\nГроші: ${u.points||0} ₴\nРівень: ${u.lvl||1}\nПароль: ${u.pass||'—'}\n───────────────────────`);
  }
}

async function deletePlayer() {
  let nick = document.getElementById("nickEdit").value.trim();
  if (!nick) return alert("Введи нік!");
  if (!confirm(`Видалити гравця ${nick}?`)) return;
  await fetch(DB + "users/" + nick + ".json", {method: "DELETE"});
  print(`Гравець ${nick} видалений`);
}

async function editMoney(add) {
  let nick = document.getElementById("nickEdit").value.trim();
  if (!nick) return alert("Введи нік!");
  let amt = prompt(add ? "Скільки додати?" : "Скільки відняти?");
  amt = parseInt(amt);
  if (isNaN(amt) || amt <= 0) return alert("Невірна сума");
  
  let r = await fetch(DB + "users/" + nick + ".json");
  let u = await r.json();
  if (!u) return alert("Гравця не знайдено");
  
  u.points = (u.points || 0) + (add ? amt : -amt);
  u.points = Math.max(0, u.points);
  
  await fetch(DB + "users/" + nick + ".json", {
    method: "PUT",
    body: JSON.stringify(u)
  });
  print(`${add ? "+" : "-"} ${amt} ₴ гравцю ${nick}. Новий баланс: ${u.points}`);
}

async function editLevel() {
  let nick = document.getElementById("nickEdit").value.trim();
  if (!nick) return alert("Введи нік!");
  let lvl = prompt("Новий рівень (1–50):");
  lvl = parseInt(lvl);
  if (isNaN(lvl) || lvl < 1 || lvl > 50) return alert("Рівень від 1 до 50");
  
  let r = await fetch(DB + "users/" + nick + ".json");
  let u = await r.json();
  if (!u) return alert("Гравця не знайдено");
  
  u.lvl = lvl;
  
  await fetch(DB + "users/" + nick + ".json", {
    method: "PUT",
    body: JSON.stringify(u)
  });
  print(`Рівень гравця ${nick} змінено на ${lvl}`);
}

async function getBotChat() {
  let data = await fetchData("bot_chat");
  print("=== ЧАТ БОТА ===");
  if (Object.keys(data).length === 0) return print("Повідомлень немає");
  for (let key in data) {
    let m = data[key];
    print(`[${m.time}] БОТ: ${m.text}`);
  }
}

async function clearBotChat() {
  if (!confirm("Очистити весь чат бота?")) return;
  await fetch(DB + "bot_chat.json", {method: "DELETE"});
  print("Чат бота повністю очищено");
}

async function getUserLogs() {
  let data = await fetchData("user_logs");
  print("=== ЛОГ ВХОДІВ ГРАВЦІВ ===");
  if (Object.keys(data).length === 0) return print("Записів немає");
  for (let key in data) {
    let l = data[key];
    print(`${l.time} → ${l.game_nick} (${l.tg_username||'немає TG'})`);
  }
}

async function getAdminLogs() {
  let data = await fetchData("admin_logs");
  print("=== ЛОГ АДМІН ДІЙ ===");
  if (Object.keys(data).length === 0) return print("Записів немає");
  for (let key in data) {
    let l = data[key];
    print(`${l.time} → ${l.nick}`);
  }
}

async function getStats() {
  let users = await fetchData("users");
  let count = Object.keys(users).length;
  let totalMoney = 0;
  for (let u in users) totalMoney += users[u].points || 0;
  
  print("=== ЗАГАЛЬНА СТАТИСТИКА ===");
  print(`Кількість гравців: ${count}`);
  print(`Загальні гроші в грі: ${totalMoney} ₴`);
  print(`Середній баланс: ${count ? (totalMoney/count).toFixed(0) : 0} ₴`);
}

function clearScreen() {
  document.getElementById("output").innerHTML = '<pre>Екран очищено...</pre>';
}
</script>
</body>
</html>
