<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>UkrMova Pro</title>
  <style>
    :root{--blue:#00a2ff;--red:#ff4d4d;--green:#2ecc71;--gold:#f1c40f;--dark:#d32f2f}
    body{
      margin:0;
      padding:0;
      background:url('https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Ukrainian_ornament.svg/800px-Ukrainian_ornament.svg.png') repeat;
      background-size:160px;
      color:#000;
      font-family:sans-serif;
      overflow:hidden;
    }
    #splash{
      position:fixed;
      inset:0;
      z-index:9999;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
    }
    #splash-video{
      width:100%;
      height:100%;
      object-fit:cover;
      position:absolute;
      top:0;
      left:0;
    }
    #startBtn{
      position:relative;
      z-index:10000;
      padding:20px 40px;
      font-size:28px;
      font-weight:bold;
      background:var(--blue);
      color:white;
      border:none;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 0 20px rgba(0,162,255,0.6);
      transition:all 0.3s;
    }
    #startBtn:hover{
      transform:scale(1.1);
      box-shadow:0 0 30px rgba(0,162,255,0.9);
    }
    .screen{display:none;flex-direction:column;min-height:100vh;padding:20px;box-sizing:border-box}
    .active{display:flex}
    .card{
      background:rgba(255,255,255,0.92);
      backdrop-filter:blur(10px);
      padding:20px;
      border-radius:20px;
      border:1px solid #444;
      margin:auto;
      width:100%;
      max-width:450px;
      box-shadow:0 0 20px rgba(0,0,0,0.3);
    }
    .btn{
      background:var(--blue);
      color:#fff;
      border:none;
      padding:14px;
      border-radius:12px;
      font-weight:700;
      width:100%;
      margin:6px 0;
      cursor:pointer;
      text-transform:uppercase;
      transition:all .2s;
    }
    .btn:hover{transform:scale(1.02);box-shadow:0 0 15px rgba(0,162,255,.6)}
    .btn.green{background:var(--green)}
    .btn.danger{background:var(--dark)}
    .money{font-size:32px;font-weight:900;color:var(--gold);text-shadow:0 0 10px #f1c40f}
    .nickname{font-size:28px;font-weight:bold;margin:10px 0;cursor:pointer}
    .gold-nick{color:var(--gold);text-shadow:0 0 10px var(--gold)}
    input{background:#f5f5f5;border:1px solid #444;padding:10px;border-radius:8px;color:#000;width:90%;margin-bottom:8px}
    .shop-item{background:#eee;padding:12px;margin:8px 0;border-radius:10px;cursor:pointer}
    .shop-item.bought{background:#c8e6c9}
    .shop-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .theme-btn{background:#9c27b0;color:white}
    .log-box{
      max-height:220px;
      overflow-y:auto;
      border:1px solid #ccc;
      padding:10px;
      margin:10px 0;
      background:#f8f8f8;
      border-radius:8px;
    }
    .log-entry{padding:4px 0;border-bottom:1px solid #eee}
    #admin-panel{
      border:2px dashed var(--red);
      padding:20px;
      margin-top:15px;
      display:none;
      background:rgba(255,255,255,0.92);
      text-align:left;
      border-radius:15px;
      max-height:80vh;
      overflow-y:auto;
    }
    #feedback{text-align:center;font-size:48px;font-weight:bold;margin:20px 0;min-height:60px}
    .correct {color:#2ecc71;}
    .wrong {color:#ff4d4d;}
    .summary {font-size:24px; line-height:1.6; margin:30px 0; text-align:center;}
    .summary strong {font-size:28px;}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  </style>
</head>
<body>

<!-- –ó–∞—Å—Ç–∞–≤–∫–∞ –∑ –≤—ñ–¥–µ–æ + –∫–Ω–æ–ø–∫–∞ -->
<div id="splash">
  <video id="splash-video" playsinline preload="auto"></video>
  <button id="startBtn">–ü–æ—á–∞—Ç–∏ –≥—Ä—É</button>
</div>

<!-- –ï–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó -->
<div id="auth-screen" class="screen">
  <div class="card">
    <h2 style="color:var(--gold)">UKRMOVA PRO</h2>
    <input type="text" id="nick" placeholder="–ù—ñ–∫–Ω–µ–π–º" autocomplete="off">
    <input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="off">
    <button class="btn" onclick="auth()">–£–í–Ü–ô–¢–ò / –ó–ê–†–ï–Ñ–°–¢–†–£–í–ê–¢–ò–°–Ø</button>
    <p id="auth-error" style="color:red; margin-top:10px; min-height:24px;"></p>
  </div>
</div>

<!-- –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é -->
<div id="menu" class="screen">
  <div class="card">
    <h3 onclick="admT()" style="cursor:pointer">–ú–ï–ù–Æ</h3>
    <div class="nickname" id="playerNick"></div>
    <div class="money"><span id="mon">0</span> ‚Ç¥</div>
    <button class="btn" onclick="show('themes')">–ì–†–ê–¢–ò</button>
    <button class="btn" style="background:#333" onclick="loadT()">–¢–û–ü</button>
    <button class="btn green" onclick="show('shop')">–ú–ê–ì–ê–ó–ò–ù</button>

    <div id="admin-panel">
      <b style="color:var(--red);cursor:pointer;font-size:18px" onclick="closeAdm()">‚ùå –ó–ê–ö–†–ò–¢–ò –ê–î–ú–Ü–ù–ö–£</b><br><br>

      <button class="btn" id="pen-btn" style="background:var(--red)" onclick="toggleP()">–®–¢–†–ê–§–ò: –í–ö–õ</button>

      <p><b>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—Ä–∞–≤—Ü—è–º–∏</b></p>
      <input type="text" id="a-n" placeholder="–ù—ñ–∫ –≥—Ä–∞–≤—Ü—è">
      <button class="btn" style="background:var(--green);color:#000" onclick="edO(true)">+ –ì–†–û–®–Ü</button>
      <button class="btn" style="background:var(--red)" onclick="edO(false)">- –ì–†–û–®–Ü</button>
      <button class="btn danger" onclick="delU()">–í–ò–î–ê–õ–ò–¢–ò –ó–ê –ù–Ü–ö–û–ú</button>
      <br><br>
      <button class="btn" style="background:var(--blue);width:100%" onclick="loadPlayers()">–ü–û–ö–ê–ó–ê–¢–ò –í–°–Ü–• –ì–†–ê–í–¶–Ü–í</button>
      <div id="player-list" style="max-height:250px;overflow-y:auto;margin:15px 0;background:#fff;padding:10px;border:1px solid #ccc;border-radius:8px"></div>

      <br><br>
      <h4 style="color:var(--blue)">–õ–æ–≥ —É—Å—ñ—Ö –≤—Ö–æ–¥—ñ–≤ —É –≥—Ä—É</h4>
      <div id="user-log" class="log-box">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
      <button class="btn" style="background:#ff9800;margin-top:8px;width:48%;margin-right:4%" onclick="loadUserLog()">–û–Ω–æ–≤–∏—Ç–∏</button>
      <button class="btn danger" style="margin-top:8px;width:48%" onclick="clearUserLog()">–û—á–∏—Å—Ç–∏—Ç–∏</button>

      <br><br>
      <h4 style="color:var(--blue)">–õ–æ–≥ –≤—Ö–æ–¥—ñ–≤ –≤ –∞–¥–º—ñ–Ω–∫—É</h4>
      <div id="admin-log" class="log-box">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
      <button class="btn" style="background:#ff9800;margin-top:8px;width:48%;margin-right:4%" onclick="loadAdminLogs()">–û–Ω–æ–≤–∏—Ç–∏</button>
      <button class="btn danger" style="margin-top:8px;width:48%" onclick="clearAdminLogs()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–∞–≥–∞–∑–∏–Ω -->
<div id="shop" class="screen">
  <div class="card">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="shop-grid">
      <div class="shop-item" onclick="buyItem('gold_frame')">–ó–æ–ª–æ—Ç–∞ —Ä–∞–º–∫–∞ ‚Äî 1000 ‚Ç¥</div>
      <div class="shop-item" onclick="buyItem('crown')">–ö–æ—Ä–æ–Ω–∞ ‚Äî 2000 ‚Ç¥</div>
      <div class="shop-item" onclick="buyItem('fire')">–ü–æ–ª—É–º'—è ‚Äî 1500 ‚Ç¥</div>
      <div class="shop-item" onclick="buyItem('shield')">–©–∏—Ç ‚Äî 2500 ‚Ç¥</div>
      <div class="shop-item" onclick="buyItem('vip')">–í–Ü–ü ‚Äî 5000 ‚Ç¥</div>
    </div>
    <button class="btn" onclick="show('menu')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<!-- –í–∏–±—ñ—Ä —Ä–æ–∑–¥—ñ–ª—É -->
<div id="themes" class="screen">
  <div class="card">
    <h2>–û–±–µ—Ä–∏ —Ä–æ–∑–¥—ñ–ª</h2>
    <button class="btn theme-btn" onclick="show('imennyky')">–Ü–º–µ–Ω–Ω–∏–∫–∏</button>
    <button class="btn theme-btn" onclick="show('prykmetnyky')">–ü—Ä–∏–∫–º–µ—Ç–Ω–∏–∫–∏</button>
    <button class="btn red" onclick="show('menu')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<!-- –¢–µ–º–∏ –Ü–º–µ–Ω–Ω–∏–∫—ñ–≤ -->
<div id="imennyky" class="screen">
  <div class="card">
    <h2>–Ü–º–µ–Ω–Ω–∏–∫–∏</h2>
    <button class="btn theme-btn" onclick="startTheme('vydminy')">–í—ñ–¥–º—ñ–Ω–∏ —ñ–º–µ–Ω–Ω–∏–∫—ñ–≤</button>
    <button class="btn theme-btn" onclick="startTheme('orudnyi_1vidmina')">–û—Ä—É–¥–Ω–∏–π –≤—ñ–¥–º—ñ–Ω–æ–∫ 1 –≤—ñ–¥–º—ñ–Ω–∏</button>
    <button class="btn red" onclick="show('themes')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<!-- –¢–µ–º–∏ –ü—Ä–∏–∫–º–µ—Ç–Ω–∏–∫—ñ–≤ -->
<div id="prykmetnyky" class="screen">
  <div class="card">
    <h2>–ü—Ä–∏–∫–º–µ—Ç–Ω–∏–∫–∏</h2>
    <button class="btn theme-btn" onclick="startTheme('prykmetnyky')">–ü—Ä–∏–∫–º–µ—Ç–Ω–∏–∫–∏</button>
    <button class="btn theme-btn" onclick="startTheme('grupy_prykmetnykiv')">–ì—Ä—É–ø–∏ –ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫—ñ–≤ –∑–∞ –∑–Ω–∞—á–µ–Ω–Ω—è–º</button>
    <button class="btn theme-btn" onclick="startTheme('prykmetnyky_stupeni')">–°—Ç—É–ø–µ–Ω—ñ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–∏–∫–º–µ—Ç–Ω–∏–∫—ñ–≤</button>
    <button class="btn red" onclick="show('themes')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<!-- –ì—Ä–∞ -->
<div id="game" class="screen">
  <div class="card">
    <h3 id="qtext"></h3>
    <div id="feedback"></div>
    <div id="abox"></div>
    <button class="btn red" style="margin-top:20px;" onclick="show('themes')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<!-- –¢–æ–ø -->
<div id="top" class="screen">
  <div class="card">
    <h3>–¢–û–ü 1000</h3>
    <div id="tlist">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    <button class="btn" onclick="show('menu')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<script>
// ================================================
// –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü
// ================================================
const DB = "https://ukrmova-game-default-rtdb.europe-west1.firebasedatabase.app/";
let user = null;
let cC = 0;
let pOn = true;
let currentTheme = '';
let currentIndex = 0;
let correctCount = 0;
let wrongCount = 0;
let items = { gold_frame: false, crown: false, fire: false, shield: false, vip: false };
let currentCorrectAnswer = '';

const correctSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3");
const wrongSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3");

// ================================================
// –¢–ï–ú–ò (–≤—Å—ñ —Å–ø–∏—Å–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ)
// ================================================
const themes = {
  vydminy: [ /* –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∫–æ–¥—É */ ],
  prykmetnyky: [ /* –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ */ ],
  grupy_prykmetnykiv: [ /* –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ */ ],
  orudnyi_1vidmina: [ /* –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ */ ],
  prykmetnyky_stupeni: [ /* –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ */ ].sort(() => Math.random() - 0.5)
};

// ================================================
// –ó–ê–ü–£–°–ö –í–Ü–î–ï–û –ß–ï–†–ï–ó –ö–ù–û–ü–ö–£
// ================================================
window.onload = function() {
  const splash = document.getElementById('splash');
  const video = document.getElementById('splash-video');
  const startBtn = document.getElementById('startBtn');

  video.src = "https://file.garden/aZHnP_3ch2qR4tWj/video_2026-02-14_17-15-12.mp4";

  startBtn.onclick = function() {
    video.muted = false;
    video.currentTime = 0;
    video.play().then(() => {
      console.log("–í—ñ–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ –∑—ñ –∑–≤—É–∫–æ–º –ø—ñ—Å–ª—è –∫–ª—ñ–∫—É");
    }).catch(e => console.log("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è:", e));
    startBtn.style.display = 'none';
  };

  video.onended = function() {
    splash.style.display = 'none';
    tryAutoLogin();
  };
};

function tryAutoLogin() {
  const savedNick = localStorage.getItem('un');
  const savedPass = localStorage.getItem('up');

  if (savedNick && savedPass) {
    document.getElementById('nick').value = savedNick;
    document.getElementById('pass').value = savedPass;
    auth();
  } else {
    show('auth-screen');
  }
}

// ================================================
// –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø
// ================================================
async function auth() {
  let n = document.getElementById('nick').value.trim();
  let p = document.getElementById('pass').value.trim();
  if(!n || !p) {
    document.getElementById('auth-error').textContent = "–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º —Ç–∞ –ø–∞—Ä–æ–ª—å";
    return;
  }
  document.getElementById('auth-error').textContent = "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";
  try {
    let r = await fetch(DB + "users/" + n + ".json");
    let d = await r.json();
    if (d) {
      if (d.pass !== p) {
        document.getElementById('auth-error').textContent = "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–∞—Ä–æ–ª—å!";
        return;
      }
      user = d;
    } else {
      user = {name:n, pass:p, points:0, items:{gold_frame:false}};
      await fetch(DB + "users/" + n + ".json", {method:'PUT', body:JSON.stringify(user)});
    }
    localStorage.setItem('un', n);
    localStorage.setItem('up', p);
    const now = new Date().toLocaleString('uk-UA',{timeZone:'Europe/Kyiv'});
    await fetch(DB + "user_logs.json", {method:'POST',body:JSON.stringify({game_nick:n, time:now})});
    items = user.items || {gold_frame:false};
    save();
    applyItems();
    update();
    show('menu');
    document.getElementById('auth-error').textContent = "";
  } catch(e) {
    document.getElementById('auth-error').textContent = "–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è";
    console.error(e);
  }
}

// ================================================
// –ê–î–ú–Ü–ù–ö–ê ‚Äì –õ–û–ì–£–í–ê–ù–ù–Ø + –û–ù–û–í–õ–ï–ù–ù–Ø / –û–ß–ò–©–ï–ù–ù–Ø
// ================================================
function admT() {
  if(++cC >= 5) {
    document.getElementById('admin-panel').style.display = 'block';
    logAdminAccess();    // –ª–æ–≥—É—î–º–æ –≤—Ö—ñ–¥
    loadAdminLogs();     // –æ–¥—Ä–∞–∑—É –ø–æ–∫–∞–∑—É—î–º–æ –ª–æ–≥ –∞–¥–º—ñ–Ω–∫–∏
    loadUserLog();       // –ø–æ–∫–∞–∑—É—î–º–æ –ª–æ–≥ –≥—Ä–∏
    cC = 0;
  }
}

async function logAdminAccess() {
  const now = new Date().toLocaleString('uk-UA', { timeZone: 'Europe/Kyiv' });
  const nick = user ? user.name : "–ê–Ω–æ–Ω—ñ–º";
  const entry = { nick: nick, time: now };
  await fetch(DB + "admin_logs.json", {
    method: 'POST',
    body: JSON.stringify(entry)
  });
}

// ================================================
// –†–ï–®–¢–ê –§–£–ù–ö–¶–Ü–ô (–±–µ–∑ –∑–º—ñ–Ω)
// ================================================
function save() {
  user.items = items;
  fetch(DB + "users/" + user.name + ".json", {method:'PUT', body:JSON.stringify(user)});
}

function update() {
  document.getElementById('mon').innerText = user.points.toLocaleString();
}

function applyItems() {
  let nickDisplay = user.name;
  if(items.gold_frame) nickDisplay += ' <span class="gold-nick">[–ó–æ–ª–æ—Ç–æ]</span>';
  if(items.crown) nickDisplay += ' üëë';
  if(items.fire) nickDisplay += ' üî•';
  if(items.shield) nickDisplay += ' üõ°Ô∏è';
  if(items.vip) nickDisplay += ' üíé VIP';
  document.getElementById('playerNick').innerHTML = nickDisplay;
}

function show(id) {
  document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}

function closeAdm() { 
  document.getElementById('admin-panel').style.display='none'; 
  cC = 0; 
}

function toggleP() {
  pOn = !pOn;
  document.getElementById('pen-btn').innerText = pOn ? "–®–¢–†–ê–§–ò: –í–ö–õ" : "–®–¢–†–ê–§–ò: –í–ò–ö–õ";
  document.getElementById('pen-btn').style.background = pOn ? "var(--red)" : "var(--green)";
}

async function delU() {
  let n = document.getElementById('a-n').value.trim();
  if(!n) return alert("–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º");
  if(confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ ${n}?`)) {
    await fetch(DB+"users/"+n+".json", {method:'DELETE'});
    alert("–í–∏–¥–∞–ª–µ–Ω–æ");
    loadPlayers();
  }
}

async function edO(add) {
  let n = document.getElementById('a-n').value.trim();
  if(!n) return alert("–í–≤–µ–¥—ñ—Ç—å –Ω–∏–∫");
  let amt = prompt(add ? "–°–∫—ñ–ª—å–∫–∏ –¥–æ–¥–∞—Ç–∏?" : "–°–∫—ñ–ª—å–∫–∏ –≤—ñ–¥–Ω—è—Ç–∏?");
  if(isNaN(amt) || amt <= 0) return alert("–ù–µ–≤—ñ—Ä–Ω–∞ —Å—É–º–∞");
  amt = parseInt(amt);
  let r = await fetch(DB+"users/"+n+".json"), d = await r.json();
  if(!d) return alert("–ì—Ä–∞–≤—Ü—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
  d.points += add ? amt : -amt;
  d.points = Math.max(0, d.points);
  await fetch(DB+"users/"+n+".json", {method:'PUT', body:JSON.stringify(d)});
  alert("–ì—Ä–æ—à—ñ –æ–Ω–æ–≤–ª–µ–Ω–æ");
  loadPlayers();
}

async function loadPlayers() {
  let r = await fetch(DB + "users/.json"), d = await r.json(), list = document.getElementById('player-list');
  list.innerHTML = '';
  if (!d || !Object.keys(d).length) {
    list.innerHTML = '<div style="padding:12px;color:#aaa">–ì—Ä–∞–≤—Ü—ñ–≤ –Ω–µ–º–∞—î</div>';
    return;
  }
  for (let key in d) {
    let u = d[key];
    let displayNick = u.name || key;
    list.innerHTML += `
      <div style="padding:10px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong>${displayNick}</strong><br>
          <small>–ë–∞–ª–∞–Ω—Å: ${u.points || 0} ‚Ç¥ | –ü–∞—Ä–æ–ª—å: ${u.pass || '‚Äî'}</small>
        </div>
      </div>
    `;
  }
}

async function loadUserLog() {
  try {
    let r = await fetch(DB + "user_logs.json");
    let data = await r.json();
    let logDiv = document.getElementById('user-log');
    logDiv.innerHTML = '';
    if (data) {
      Object.values(data).reverse().slice(0,100).forEach(entry => {
        logDiv.innerHTML += `<div class="log-entry">${entry.time} ‚Äî <b>${entry.game_nick}</b></div>`;
      });
    } else {
      logDiv.innerHTML = '–õ–æ–≥ –ø–æ—Ä–æ–∂–Ω—ñ–π';
    }
  } catch (e) {
    document.getElementById('user-log').innerHTML = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è';
  }
}

async function clearUserLog() {
  if (!confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥ —É—Å—ñ—Ö –≤—Ö–æ–¥—ñ–≤?")) return;
  await fetch(DB + "user_logs.json", {method: 'DELETE'});
  loadUserLog();
  alert("–õ–æ–≥ –≤—Ö–æ–¥—ñ–≤ –æ—á–∏—â–µ–Ω–æ");
}

async function loadAdminLogs() {
  try {
    let r = await fetch(DB + "admin_logs.json");
    let data = await r.json();
    let logDiv = document.getElementById('admin-log');
    logDiv.innerHTML = '';
    if (data && Object.keys(data).length > 0) {
      Object.values(data).reverse().forEach(log => {
        logDiv.innerHTML += `<div class="log-entry">${log.time} ‚Äî <b>${log.nick}</b></div>`;
      });
    } else {
      logDiv.innerHTML = '–õ–æ–≥ –ø–æ—Ä–æ–∂–Ω—ñ–π';
    }
  } catch (e) {
    document.getElementById('admin-log').innerHTML = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–≥—É';
  }
}

async function clearAdminLogs() {
  if (!confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥ –∞–¥–º—ñ–Ω–∫–∏?")) return;
  await fetch(DB + "admin_logs.json", {method: 'DELETE'});
  loadAdminLogs();
  alert("–õ–æ–≥ –∞–¥–º—ñ–Ω–∫–∏ –æ—á–∏—â–µ–Ω–æ");
}

function startTheme(theme) {
  currentTheme = theme;
  currentIndex = 0;
  correctCount = 0;
  wrongCount = 0;
  show('game');
  loadQuestion();
}

function loadQuestion() {
  const qs = themes[currentTheme];
  if (currentIndex >= qs.length) {
    document.getElementById('qtext').textContent = "–¢–µ–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!";
    document.getElementById('feedback').innerHTML = '';
    document.getElementById('abox').innerHTML = `
      <div class="summary">
        <strong>–ì—Ä–∞–≤–µ—Ü—å:</strong> ${user ? user.name : '‚Äî'}<br><br>
        <strong style="color:var(--green)">–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π:</strong> ${correctCount}<br>
        <strong style="color:var(--red)">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π:</strong> ${wrongCount}<br><br>
        <strong>–ü–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å:</strong> ${user ? user.points.toLocaleString() : 0} ‚Ç¥
      </div>
      <button class="btn" onclick="show('themes')">–û–±—Ä–∞—Ç–∏ —ñ–Ω—à—É —Ç–µ–º—É</button>
    `;
    save();
    return;
  }
  const q = qs[currentIndex];
  currentCorrectAnswer = q.a;
  document.getElementById('qtext').textContent = `–ü–∏—Ç–∞–Ω–Ω—è ${currentIndex+1}/${qs.length}: ${q.q}`;
  document.getElementById('feedback').innerHTML = '';
  const abox = document.getElementById('abox');
  abox.innerHTML = '';
  let answers = [q.a, ...q.w];
  answers.sort(() => Math.random() - 0.5);
  answers.forEach(o => {
    let btn = document.createElement('button');
    btn.className = 'btn';
    btn.innerText = o;
    btn.onclick = () => checkAnswer(o, q.a, btn);
    abox.appendChild(btn);
  });
}

function checkAnswer(selected, correct, button) {
  document.querySelectorAll('#abox .btn').forEach(b => b.disabled = true);
  if (selected === correct) {
    correctCount++;
    user.points += 100;
    button.style.background = 'var(--green)';
    button.style.color = 'white';
    document.getElementById('feedback').innerHTML = '<span class="correct">–ü–†–ê–í–ò–õ–¨–ù–û!</span>';
    correctSound.currentTime = 0;
    correctSound.play().catch(()=>{});
  } else {
    wrongCount++;
    user.points = Math.max(0, user.points - 30);
    button.style.background = 'var(--red)';
    button.style.color = 'white';
    document.getElementById('feedback').innerHTML = '<span class="wrong">‚ùå</span>';
    wrongSound.currentTime = 0;
    wrongSound.play().catch(()=>{});
  }
  document.getElementById('mon').innerText = user.points.toLocaleString();
  save();
  setTimeout(() => {
    currentIndex++;
    loadQuestion();
  }, 1000);
}

async function loadT() {
  show('top');
  let r = await fetch(DB+"users/.json"), d = await r.json();
  let l = document.getElementById('tlist');
  l.innerHTML = '';
  if(d) {
    let topPlayers = Object.values(d).sort((a,b)=> (b.points||0) - (a.points||0)).slice(0,1000);
    topPlayers.forEach((u,i) => {
      l.innerHTML += `<div style="display:flex;justify-content:space-between;padding:8px">
        <span>${i+1}. ${u.name}</span><b>${u.points||0}</b>
      </div>`;
    });
  } else {
    l.innerHTML = '<div style="padding:12px;color:#aaa">–¢–æ–ø –ø–æ—Ä–æ–∂–Ω—ñ–π</div>';
  }
}

function buyItem(item) {
  const prices = {gold_frame:1000, crown:2000, fire:1500, shield:2500, vip:5000};
  if(user.points >= prices[item]){
    user.points -= prices[item];
    items[item] = true;
    applyItems();
    save(); update();
    alert("–ö—É–ø–ª–µ–Ω–æ: " + item);
  } else alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≥—Ä–æ—à–µ–π!");
}
</script>
</body>
</html>
