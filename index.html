<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>UkrMova Pro</title>
<style>
:root {
  --blue: #00a2ff;
  --red: #ff4d4d;
  --green: #2ecc71;
  --gold: #f1c40f;
  --dark: #d32f2f;
}
body {
  background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Ukrainian_ornament.svg/800px-Ukrainian_ornament.svg.png') repeat;
  background-size: 160px;
  color: #000;
  font-family: sans-serif;
  margin: 0;
  text-align: center;
}
.screen { display: none; padding: 20px; flex-direction: column; min-height: 100vh; box-sizing: border-box; }
.active { display: flex; animation: fadeIn 0.3s ease; }
.card {
  background: rgba(255,255,255,0.92);
  backdrop-filter: blur(10px);
  padding: 20px;
  border-radius: 20px;
  border: 1px solid #444;
  margin: auto;
  width: 100%;
  max-width: 450px;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
}
.btn {
  background: var(--blue);
  color: #fff;
  border: none;
  padding: 14px;
  border-radius: 12px;
  font-weight: 700;
  width: 100%;
  margin: 8px 0;
  cursor: pointer;
  text-transform: uppercase;
  transition: all 0.2s;
}
.btn:hover { transform: scale(1.02); box-shadow: 0 0 15px rgba(0,162,255,0.6); }
.btn.green { background: var(--green); }
.btn.danger { background: var(--dark); }
.money { font-size: 32px; font-weight: 900; color: var(--gold); text-shadow: 0 0 10px #f1c40f; }
.nickname { font-size: 28px; font-weight: bold; margin: 10px 0; }
input {
  background: #f5f5f5;
  border: 1px solid #444;
  padding: 12px;
  border-radius: 8px;
  width: 90%;
  margin: 8px 0;
  font-size: 16px;
}
#auth-error { color: red; margin-top: 10px; min-height: 24px; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<!-- Авторизація -->
<div id="auth-screen" class="screen active">
  <div class="card">
    <h2 style="color:var(--gold)">UKRMOVA PRO</h2>
    <input type="text" id="nick" placeholder="Нікнейм" autocomplete="off">
    <input type="password" id="pass" placeholder="Пароль" autocomplete="off">
    <button class="btn" onclick="auth()">УВІЙТИ / ЗАРЕЄСТРУВАТИСЯ</button>
    <p id="auth-error"></p>
  </div>
</div>

<!-- Меню -->
<div id="menu" class="screen">
  <div class="card">
    <h2>МЕНЮ</h2>
    <div class="nickname" id="playerNick"></div>
    <div class="money"><span id="mon">0</span> ₴</div>
    <button class="btn" onclick="show('themes')">ГРАТИ</button>
    <button class="btn danger" onclick="logout()">ВИЙТИ</button>
  </div>
</div>

<!-- Вибір теми -->
<div id="themes" class="screen">
  <div class="card">
    <h2>Обери тему</h2>
    <button class="btn theme-btn" onclick="startTheme('vydminy')">Відміни іменників</button>
    <button class="btn theme-btn" onclick="startTheme('prykmetnyky')">Прикметники</button>
    <button class="btn theme-btn" onclick="startTheme('grupy_prykmetnykiv')">Групи прикметників за значенням</button>
    <button class="btn theme-btn" onclick="startTheme('orudnyi_1vidmina')">Орудний відмінок 1 відміни (-ою/-ею/-єю)</button>
    <button class="btn red" onclick="show('menu')">НАЗАД</button>
  </div>
</div>

<!-- Гра -->
<div id="game" class="screen">
  <div class="card">
    <h3 id="qtext"></h3>
    <div id="abox"></div>
    <button class="btn red" style="margin-top:20px;" onclick="show('themes')">НАЗАД</button>
  </div>
</div>

<script>
const DB = "https://ukrmova-game-default-rtdb.europe-west1.firebasedatabase.app/";
let user = null;
let currentTheme = '';
let currentIndex = 0;
let correct = 0;
let wrong = 0;

const correctSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3");
const wrongSound   = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3");

const themes = {
  vydminy: [
    {q:"До якої відміни належить слово «книга»?", a:"перша відміна", w:["друга відміна"]},
    {q:"До якої відміни належить слово «стіл»?", a:"друга відміна", w:["перша відміна"]},
    {q:"До якої відміни належить слово «мати»?", a:"третя відміна", w:["перша відміна"]},
    {q:"До якої відміни належить слово «ім'я»?", a:"четверта відміна", w:["третя відміна"]},
    {q:"До якої відміни належать іменники середнього роду на -о/-е?", a:"друга відміна", w:["перша відміна"]},
    {q:"До якої відміни належить слово «любов»?", a:"третя відміна", w:["друга відміна"]},
    {q:"До якої відміни належить слово «сіль»?", a:"третя відміна", w:["четверта відміна"]},
    {q:"До якої відміни належить слово «серце»?", a:"друга відміна", w:["третя відміна"]},
    {q:"До якої відміни належить слово «земля»?", a:"перша відміна", w:["третя відміна"]},
    {q:"До якої відміни належить слово «день»?", a:"друга відміна", w:["перша відміна"]}
    // можна додати ще
  ],
  prykmetnyky: [
    {q:"Який рід прикметника «гарна дівчина»?", a:"жіночий рід", w:["чоловічий рід"]},
    {q:"Який рід прикметника «велике поле»?", a:"середній рід", w:["жіночий рід"]},
    {q:"Який рід прикметника «сильний чоловік»?", a:"чоловічий рід", w:["жіночий рід"]},
    {q:"Який рід прикметника «красива квітка»?", a:"жіночий рід", w:["середній рід"]},
    {q:"Який рід прикметника «нове авто»?", a:"середній рід", w:["чоловічий рід"]}
    // можна додати ще
  ],
  grupy_prykmetnykiv: [
    {q:"До якої групи за значенням належить прикметник «гарна» (гарна дівчина)?", a:"якісний", w:["відносний", "присвійний"]},
    {q:"До якої групи належить «дерев’яний» (дерев’яний стіл)?", a:"відносний", w:["якісний", "присвійний"]},
    {q:"До якої групи належить «мамина» (мамина сумка)?", a:"присвійний", w:["якісний", "відносний"]},
    {q:"До якої групи належить «залізний» (залізний характер)?", a:"якісний", w:["відносний", "присвійний"]},
    {q:"До якої групи належить «вовча» (вовча зграя)?", a:"присвійний", w:["якісний", "відносний"]}
    // можна додати ще
  ],
  orudnyi_1vidmina: [
    {q:"Орудний відмінок слова «книжка»?", a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «душа»?",    a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «свіча»?",   a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «миша»?",    a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «площа»?",   a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «тиша»?",    a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «зброя»?",   a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «ніч»?",     a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «армія»?",   a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «сім'я»?",   a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «надія»?",   a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «ідея»?",    a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «лінія»?",   a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «фотографія»?", a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «історія»?", a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «традиція»?", a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «революція»?", a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «станція»?", a:"-ею", w:["-ою", "-єю"]},
    {q:"Орудний відмінок слова «вода»?",    a:"-ою", w:["-ею", "-єю"]},
    {q:"Орудний відмінок слова «рука»?",    a:"-ою", w:["-ею", "-єю"]}
  ]
};

async function auth() {
  const nick = document.getElementById('nick').value.trim();
  const pass = document.getElementById('pass').value.trim();
  const err = document.getElementById('auth-error');

  if (!nick || !pass) {
    err.textContent = "Введіть нікнейм і пароль";
    return;
  }

  err.textContent = "Завантаження...";

  try {
    let res = await fetch(`${DB}users/${nick}.json`);
    let data = await res.json();

    if (data) {
      if (data.pass === pass) {
        user = data;
      } else {
        err.textContent = "Неправильний пароль";
        return;
      }
    } else {
      user = { name: nick, pass: pass, points: 0 };
      await fetch(`${DB}users/${nick}.json`, {
        method: 'PUT',
        body: JSON.stringify(user)
      });
    }

    localStorage.setItem('un', nick);
    localStorage.setItem('up', pass);

    document.getElementById('playerNick').textContent = user.name;
    document.getElementById('mon').textContent = user.points;

    show('menu');
    err.textContent = "";
  } catch (e) {
    err.textContent = "Помилка підключення";
    console.error(e);
  }
}

function logout() {
  localStorage.removeItem('un');
  localStorage.removeItem('up');
  user = null;
  show('auth-screen');
}

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startTheme(theme) {
  currentTheme = theme;
  currentIndex = 0;
  correct = 0;
  wrong = 0;
  show('game');
  loadQuestion();
}

function loadQuestion() {
  const qs = themes[currentTheme];
  if (currentIndex >= qs.length) {
    document.getElementById('qtext').textContent = "Тема завершена!";
    document.getElementById('abox').innerHTML = `
      <div style="font-size:22px; margin:20px 0; line-height:1.6;">
        <strong>Гравець:</strong> ${user.name}<br>
        <strong style="color:var(--green)">Правильних:</strong> ${correct}<br>
        <strong style="color:var(--red)">Неправильних:</strong> ${wrong}<br><br>
        <strong>Баланс:</strong> ${user.points} ₴
      </div>
      <button class="btn" onclick="show('themes')">Обрати іншу тему</button>
    `;
    return;
  }

  const q = qs[currentIndex];
  document.getElementById('qtext').textContent = `Питання ${currentIndex+1}/${qs.length}: ${q.q}`;

  const box = document.getElementById('abox');
  box.innerHTML = '';

  let opts = [q.a, ...q.w];
  opts.sort(() => Math.random() - 0.5);

  opts.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.textContent = opt;
    btn.onclick = () => checkAnswer(opt, q.a);
    box.appendChild(btn);
  });
}

function checkAnswer(selected, correctAns) {
  if (selected === correctAns) {
    correct++;
    user.points += 100;
    correctSound.currentTime = 0;
    correctSound.play().catch(()=>{});
  } else {
    wrong++;
    user.points = Math.max(0, user.points - 30);
    wrongSound.currentTime = 0;
    wrongSound.play().catch(()=>{});
  }

  document.getElementById('mon').textContent = user.points;
  saveUser();

  currentIndex++;
  loadQuestion();
}

function saveUser() {
  if (!user) return;
  fetch(`${DB}users/${user.name}.json`, {
    method: 'PUT',
    body: JSON.stringify(user)
  }).catch(e => console.error("Помилка збереження:", e));
}

// Автозаповнення при завантаженні
window.addEventListener('load', () => {
  const savedNick = localStorage.getItem('un');
  const savedPass = localStorage.getItem('up');
  if (savedNick && savedPass) {
    document.getElementById('nick').value = savedNick;
    document.getElementById('pass').value = savedPass;
    auth();
  }
});
</script>
</body>
</html>
