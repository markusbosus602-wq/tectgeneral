<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>UkrMova Pro</title>
<style>
:root{--blue:#00a2ff;--red:#ff4d4d;--green:#2ecc71;--gold:#f1c40f;--dark:#d32f2f}
body{
  background:url('https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Flag_of_Ukraine.svg/2560px-Flag_of_Ukraine.svg.png') center/cover fixed;
  background-attachment:fixed;
  color:#000;font-family:sans-serif;margin:0;text-align:center
}
.screen{display:none;padding:20px;flex-direction:column;min-height:100vh;box-sizing:border-box}
.active{display:flex;animation:fadeIn .3s ease}
.card{background:rgba(255,255,255,0.92);backdrop-filter:blur(10px);padding:20px;border-radius:20px;border:1px solid #444;margin:auto;width:100%;max-width:450px;box-shadow:0 0 20px rgba(0,0,0,0.3)}
.btn{background:var(--blue);color:#fff;border:none;padding:14px;border-radius:12px;font-weight:700;width:100%;margin:6px 0;cursor:pointer;text-transform:uppercase;transition:all .2s}
.btn:hover{transform:scale(1.02);box-shadow:0 0 15px rgba(0,162,255,.6)}
.btn.green{background:var(--green)}
.btn.danger{background:var(--dark)}
.money{font-size:32px;font-weight:900;color:var(--gold);text-shadow:0 0 10px #f1c40f}
.nickname{font-size:28px;font-weight:bold;margin:10px 0;cursor:pointer}
.gold-nick{color:var(--gold);text-shadow:0 0 10px var(--gold)}
.lvl-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;max-height:40vh;overflow-y:auto;padding:10px}
.lvl{background:rgba(51,51,51,0.7);padding:12px 0;border-radius:10px;opacity:0.6;transition:all .3s;border:1px solid #ccc}
.lvl.open{opacity:1;background:var(--blue);border:2px solid white;box-shadow:0 0 15px var(--blue);color:white}
#admin-panel{border:2px dashed var(--red);padding:15px;margin-top:15px;display:none;background:rgba(255,255,255,0.92);text-align:left;border-radius:15px}
input{background:#f5f5f5;border:1px solid #444;padding:10px;border-radius:8px;color:#000;width:90%;margin-bottom:8px}
.shop-item{background:#eee;padding:12px;margin:8px 0;border-radius:10px;cursor:pointer}
.shop-item.bought{background:#c8e6c9}
.shop-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.theme-btn{background:#9c27b0;color:white}
.log-box{max-height:220px;overflow-y:auto;border:1px solid #ccc;padding:10px;margin:10px 0;background:#f8f8f8;border-radius:8px}
.log-entry{padding:4px 0;border-bottom:1px solid #eee}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
</style>
</head>
<body>

<div id="auth-screen" class="screen active">
  <div class="card">
    <h2 style="color:var(--gold)">UKRMOVA PRO</h2>
    <input type="text" id="nick" placeholder="–ù—ñ–∫–Ω–µ–π–º">
    <input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å">
    <button class="btn" onclick="auth()">–£–í–Ü–ô–¢–ò</button>
  </div>
</div>

<div id="menu" class="screen">
  <div class="card">
    <h3 onclick="admT()" style="cursor:pointer">–ú–ï–ù–Æ</h3>
    <div class="nickname" id="playerNick"></div>
    <div class="money"><span id="mon">0</span> ‚Ç¥</div>
    <button class="btn" onclick="showThemes()">–ì–†–ê–¢–ò</button>
    <button class="btn" style="background:#333" onclick="loadT()">–¢–û–ü</button>
    <button class="btn green" onclick="show('shop')">–ú–ê–ì–ê–ó–ò–ù</button>
    <div id="admin-panel">
      <b style="color:var(--red);cursor:pointer" onclick="closeAdm()">‚ùå –ó–ê–ö–†–ò–¢–ò</b><br><br>
      <button class="btn" id="pen-btn" style="background:var(--red)" onclick="toggleP()">–®–¢–†–ê–§–ò: –í–ö–õ</button>
      <p><b>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—Ä–∞–≤—Ü—è–º–∏</b></p>
      <input type="text" id="a-n" placeholder="–ù—ñ–∫ –≥—Ä–∞–≤—Ü—è">
      <button class="btn" style="background:var(--green);color:#000" onclick="edO(true)">+ –ì–†–û–®–Ü</button>
      <button class="btn" style="background:var(--red)" onclick="edO(false)">- –ì–†–û–®–Ü</button>
      <button class="btn danger" onclick="delU()">–í–ò–î–ê–õ–ò–¢–ò –ó–ê –ù–Ü–ö–û–ú</button>
      <br><br>
      <button class="btn" style="background:var(--blue);width:100%" onclick="loadPlayers()">–ü–û–ö–ê–ó–ê–¢–ò –í–°–Ü–• –ì–†–ê–í–¶–Ü–í</button>
      <div id="player-list" style="max-height:250px;overflow-y:auto;margin:15px 0;background:#fff;padding:10px;border:1px solid #ccc;border-radius:8px"></div>
      <br><br>
      <h4 style="color:var(--blue)">–õ–æ–≥ –≤—Ö–æ–¥—ñ–≤ –≤ –∞–¥–º—ñ–Ω–∫—É</h4>
      <div id="admin-log" class="log-box">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
      <button class="btn" style="background:#ff9800" onclick="clearAdminLogs()">–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥ –∞–¥–º—ñ–Ω–∫–∏</button>
      <br><br>
      <h4 style="color:var(--blue)">–õ–æ–≥ —É—Å—ñ—Ö –≤—Ö–æ–¥—ñ–≤ —É –≥—Ä—É</h4>
      <div id="user-log" class="log-box">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
      <button class="btn" style="background:#ff9800;margin-top:8px" onclick="loadUserLog()">–û–Ω–æ–≤–∏—Ç–∏</button>
      <button class="btn danger" style="margin-top:8px" onclick="clearUserLog()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
    </div>
  </div>
</div>

<div id="shop" class="screen">
  <div class="card">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="shop-grid">
      <div class="shop-item" id="gold_frame" onclick="buyItem('gold_frame')">–ó–æ–ª–æ—Ç–∞ —Ä–∞–º–∫–∞ ‚Äî 1000 ‚Ç¥</div>
      <div class="shop-item" id="crown" onclick="buyItem('crown')">–ö–æ—Ä–æ–Ω–∞ ‚Äî 2000 ‚Ç¥</div>
      <div class="shop-item" id="fire" onclick="buyItem('fire')">–ü–æ–ª—É–º'—è ‚Äî 1500 ‚Ç¥</div>
      <div class="shop-item" id="shield" onclick="buyItem('shield')">–©–∏—Ç ‚Äî 2500 ‚Ç¥</div>
      <div class="shop-item" id="vip" onclick="buyItem('vip')">–í–Ü–ü ‚Äî 5000 ‚Ç¥</div>
    </div>
    <button class="btn" onclick="show('menu')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<div id="themes" class="screen">
  <div class="card">
    <h2>–û–±–µ—Ä–∏ —Ç–µ–º—É</h2>
    <button class="btn theme-btn" onclick="startTheme('vydminy')">–í—ñ–¥–º—ñ–Ω–∏ —ñ–º–µ–Ω–Ω–∏–∫—ñ–≤</button>
    <button class="btn theme-btn" onclick="startTheme('chasyslova')">–ß–∞—Å–∏ –¥—ñ—î—Å–ª—ñ–≤</button>
    <button class="btn theme-btn" onclick="startTheme('prykmetnyky')">–ü—Ä–∏–∫–º–µ—Ç–Ω–∏–∫–∏</button>
    <button class="btn theme-btn" onclick="startTheme('pryslinniky')">–ü—Ä–∏—Å–ª—ñ–≤–Ω–∏–∫–∏</button>
    <button class="btn theme-btn" onclick="startTheme('synonimy')">–°–∏–Ω–æ–Ω—ñ–º–∏ / –ê–Ω—Ç–æ–Ω—ñ–º–∏</button>
    <button class="btn red" onclick="show('menu')">–ù–ê–ó–ê–î</button>
  </div>
</div>

<div id="levels" class="screen"><div class="card"><h3>–†–Ü–í–ù–Ü</h3><div class="lvl-grid" id="lgrid"></div><button class="btn" onclick="show('menu')">–ù–ê–ó–ê–î</button></div></div>
<div id="game" class="screen"><div class="card"><h3 id="qtext"></h3><div id="abox"></div></div></div>
<div id="top" class="screen"><div class="card"><h3>–¢–û–ü 1000</h3><div id="tlist"></div><button class="btn" onclick="show('menu')">–ù–ê–ó–ê–î</button></div></div>

<script>
const DB = "https://ukrmova-game-default-rtdb.europe-west1.firebasedatabase.app/";
let user = null, cC = 0, pOn = true, customQ = [], usedQuestions = new Set();
let items = { gold_frame: false, crown: false, fire: false, shield: false, vip: false };
let currentTheme = '';
const correctSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3");
const wrongSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3");

document.addEventListener('click', () => {
  correctSound.play().catch(()=>{});
  wrongSound.play().catch(()=>{});
}, {once: true});

window.onload = () => {
  if(localStorage.getItem('un')) document.getElementById('nick').value = localStorage.getItem('un');
  if(localStorage.getItem('up')) document.getElementById('pass').value = localStorage.getItem('up');
};

async function auth() {
  let n = document.getElementById('nick').value.trim();
  let p = document.getElementById('pass').value.trim();

  if (!n || !p) {
    return alert("–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º —Ç–∞ –ø–∞—Ä–æ–ª—å!");
  }

  localStorage.setItem('un', n);
  localStorage.setItem('up', p);

  // –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Ö–æ–¥—É
  const tg = window.Telegram?.WebApp?.initDataUnsafe?.user || {username:"–Ω–µ–º–∞—î",id:"–Ω–µ–º–∞—î"};
  const now = new Date().toLocaleString('uk-UA',{timeZone:'Europe/Kyiv'});
  const entry = {game_nick:n, tg_username:tg.username||"–Ω–µ–º–∞—î", tg_id:tg.id||"–Ω–µ–º–∞—î", time:now};
  await fetch(DB + "user_logs.json", {method:'POST', body:JSON.stringify(entry)});

  // –ó–∞–ø–∏—Ç –¥–æ –±–∞–∑–∏
  let r = await fetch(DB + "users/" + n + ".json");
  let d = await r.json();

  if (d) {
    // –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —ñ—Å–Ω—É—î ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–∞—Ä–æ–ª—å
    if (d.pass === p) {
      user = d;
      items = user.items || {gold_frame:false};
      save();
      applyItems();
      update();
      show('menu');
    } else {
      alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–∞—Ä–æ–ª—å!");
    }
  } else {
    // –ù–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Äî —Å—Ç–≤–æ—Ä—é—î–º–æ
    user = {
      name: n,
      pass: p,
      points: 0,
      lvl: 1,
      items: {gold_frame: false}
    };
    await fetch(DB + "users/" + n + ".json", {
      method: 'PUT',
      body: JSON.stringify(user)
    });
    alert("–í—ñ—Ç–∞—î–º–æ! –í–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ —è–∫ –Ω–æ–≤–∏–π –≥—Ä–∞–≤–µ—Ü—å.");
    items = user.items;
    save();
    applyItems();
    update();
    show('menu');
  }
}

// –†–µ—à—Ç–∞ –∫–æ–¥—É –±–µ–∑ –∑–º—ñ–Ω (save, update, applyItems, show, admT, closeAdm, toggleP, delU, edO, loadPlayers, deleteUser, buyItem, showThemes, startTheme, renderL, start, check, loadT, logAdminAccess, loadAdminLogs, clearAdminLogs, loadUserLog, clearUserLog)
function save() {
  user.items = items;
  fetch(DB+"users/"+user.name+".json", {method:'PUT', body:JSON.stringify(user)});
}
function update() {
  document.getElementById('mon').innerText = user.points.toLocaleString();
}
function applyItems() {
  let nickDisplay = user.name;
  if(items.gold_frame) nickDisplay += ' <span class="gold-nick">[–ó–æ–ª–æ—Ç–æ]</span>';
  if(items.crown) nickDisplay += ' üëë';
  if(items.fire) nickDisplay += ' üî•';
  if(items.shield) nickDisplay += ' üõ°Ô∏è';
  if(items.vip) nickDisplay += ' üíé VIP';
  document.getElementById('playerNick').innerHTML = nickDisplay;
}
function show(id) {
  document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}
// ... –≤–µ—Å—å —ñ–Ω—à–∏–π –∫–æ–¥ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω ...

</script>
</body>
</html>
