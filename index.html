<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>UkrMova Pro</title>
<style>
:root{--blue:#00a2ff;--red:#ff4d4d;--green:#2ecc71;--gold:#f1c40f;--dark:#d32f2f}
body{
  background:url('https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Flag_of_Ukraine.svg/2560px-Flag_of_Ukraine.svg.png') center/cover fixed;
  background-attachment:fixed;
  color:#000;font-family:sans-serif;margin:0;text-align:center
}
.screen{display:none;padding:20px;flex-direction:column;min-height:100vh;box-sizing:border-box}
.active{display:flex;animation:fadeIn .3s ease}
.card{background:rgba(255,255,255,0.92);backdrop-filter:blur(10px);padding:20px;border-radius:20px;border:1px solid #444;margin:auto;width:100%;max-width:450px;box-shadow:0 0 20px rgba(0,0,0,0.3)}
.btn{background:var(--blue);color:#fff;border:none;padding:14px;border-radius:12px;font-weight:700;width:100%;margin:6px 0;cursor:pointer;text-transform:uppercase;transition:all .2s}
.btn:hover{transform:scale(1.02);box-shadow:0 0 15px rgba(0,162,255,.6)}
.btn.green{background:var(--green)}
.btn.danger{background:var(--dark)}
.money{font-size:32px;font-weight:900;color:var(--gold);text-shadow:0 0 10px #f1c40f}
.nickname{font-size:28px;font-weight:bold;margin:10px 0;cursor:pointer}
.gold-nick{color:var(--gold);text-shadow:0 0 10px var(--gold)}
.lvl-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;max-height:40vh;overflow-y:auto;padding:10px}
.lvl{background:rgba(51,51,51,0.7);padding:12px 0;border-radius:10px;opacity:0.6;transition:all .3s;border:1px solid #ccc}
.lvl.open{opacity:1;background:var(--blue);border:2px solid white;box-shadow:0 0 15px var(--blue);color:white}
#admin-panel{border:2px dashed var(--red);padding:15px;margin-top:15px;display:none;background:rgba(255,255,255,0.92);text-align:left;border-radius:15px}
input{background:#f5f5f5;border:1px solid #444;padding:10px;border-radius:8px;color:#000;width:90%;margin-bottom:8px}
.shop-item{background:#eee;padding:12px;margin:8px 0;border-radius:10px;cursor:pointer}
.shop-item.bought{background:#c8e6c9}
.shop-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.theme-btn{background:#9c27b0;color:white}
.log-box{max-height:220px;overflow-y:auto;border:1px solid #ccc;padding:10px;margin:10px 0;background:#f8f8f8;border-radius:8px}
.log-entry{padding:4px 0;border-bottom:1px solid #eee}
.players-list{max-height:300px;overflow-y:auto;border:1px solid #ccc;padding:10px;margin:10px 0;background:#f8f8f8;border-radius:8px}
.player-entry{padding:8px;border-bottom:1px solid #eee}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
</style>
</head>
<body>

<div id="auth-screen" class="screen active">
  <div class="card">
    <h2 style="color:var(--gold)">UKRMOVA PRO</h2>
    <input type="text" id="nick" placeholder="Нікнейм">
    <input type="password" id="pass" placeholder="Пароль">
    <button class="btn" onclick="auth()">УВІЙТИ</button>
  </div>
</div>

<div id="menu" class="screen">
  <div class="card">
    <h3 onclick="admT()" style="cursor:pointer">МЕНЮ</h3>
    <div class="nickname" id="playerNick"></div>
    <div class="money"><span id="mon">0</span> ₴</div>
    <button class="btn" onclick="showThemes()">ГРАТИ</button>
    <button class="btn" style="background:#333" onclick="loadT()">ТОП</button>
    <button class="btn" onclick="loadPlayersList()">УЧАСНИКИ</button>
    <button class="btn green" onclick="show('shop')">МАГАЗИН</button>

    <div id="admin-panel">
      <!-- адмін-панель без змін -->
      <b style="color:var(--red);cursor:pointer" onclick="closeAdm()">❌ ЗАКРИТИ</b><br><br>
      <button class="btn" id="pen-btn" style="background:var(--red)" onclick="toggleP()">ШТРАФИ: ВКЛ</button>
      <p><b>Управління гравцями</b></p>
      <input type="text" id="a-n" placeholder="Нік гравця">
      <button class="btn" style="background:var(--green);color:#000" onclick="edO(true)">+ ГРОШІ</button>
      <button class="btn" style="background:var(--red)" onclick="edO(false)">- ГРОШІ</button>
      <button class="btn danger" onclick="delU()">ВИДАЛИТИ ЗА НІКОМ</button>
      <!-- решта адмінки без змін -->
    </div>
  </div>
</div>

<!-- Екран учасників -->
<div id="players" class="screen">
  <div class="card">
    <h2>Учасники гри</h2>
    <div id="players-list" class="players-list"></div>
    <button class="btn" onclick="show('menu')">НАЗАД</button>
  </div>
</div>

<!-- інші екрани (shop, themes, levels, game, top) без змін -->

<script>
const DB = "https://ukrmova-game-default-rtdb.europe-west1.firebasedatabase.app/";

let user = null, cC = 0, pOn = true, customQ = [], usedQuestions = new Set();
let items = { gold_frame: false, crown: false, fire: false, shield: false, vip: false };
let currentTheme = '';

const correctSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3");
const wrongSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3");

document.addEventListener('click', () => {
  correctSound.play().catch(()=>{});
  wrongSound.play().catch(()=>{});
}, {once: true});

window.onload = () => {
  if(localStorage.getItem('un')) document.getElementById('nick').value = localStorage.getItem('un');
  if(localStorage.getItem('up')) document.getElementById('pass').value = localStorage.getItem('up');
};

async function auth() {
  let n = document.getElementById('nick').value.trim();
  let p = document.getElementById('pass').value.trim();

  if (!n || !p) return alert("Введіть нікнейм та пароль!");

  localStorage.setItem('un', n);
  localStorage.setItem('up', p);

  const tg = window.Telegram?.WebApp?.initDataUnsafe?.user || {username:"немає",id:"немає"};
  const now = new Date().toLocaleString('uk-UA',{timeZone:'Europe/Kyiv'});
  const entry = {game_nick:n,tg_username:tg.username||"немає",tg_id:tg.id||"немає",time:now};
  await fetch(DB + "user_logs.json", {method:'POST',body:JSON.stringify(entry)});

  let r = await fetch(DB+"users/"+n+".json");
  let d = await r.json();

  if (d) {
    // користувач існує — перевіряємо пароль
    if (d.pass !== p) {
      return alert("Неправильний пароль!");
    }
    user = d;
  } else {
    // новий користувач — створюємо
    user = {name:n, pass:p, points:0, lvl:1, items:{gold_frame:false}};
    await fetch(DB+"users/"+n+".json", {method:'PUT', body:JSON.stringify(user)});
    alert("Вітаємо! Ви зареєстровані як новий гравець.");
  }

  items = user.items || {gold_frame:false};
  save();
  applyItems();
  update();
  show('menu');
}

// решта функцій (save, update, applyItems, show, admT, closeAdm, toggleP, delU, edO, loadPlayers, deleteUser, buyItem, showThemes, startTheme, renderL, start, check, loadT, logAdminAccess, loadAdminLogs, clearAdminLogs, loadUserLog, clearUserLog) — залишаються без змін

// Нова функція для показу всіх учасників
async function loadPlayersList() {
  show('players');
  const list = document.getElementById('players-list');
  list.innerHTML = '<div style="color:#888;text-align:center">Завантаження...</div>';

  try {
    const r = await fetch(DB + "users/.json");
    const data = await r.json();

    list.innerHTML = '';

    if (!data || Object.keys(data).length === 0) {
      list.innerHTML = '<div style="padding:15px;color:#888">Ще ніхто не грав</div>';
      return;
    }

    const players = Object.values(data)
      .filter(u => u && u.name)
      .sort((a, b) => (b.points || 0) - (a.points || 0));

    players.forEach(u => {
      list.innerHTML += `
        <div class="player-entry">
          <strong>${u.name}</strong><br>
          <small>Очок: ${u.points || 0} • Рівень: ${u.lvl || 1}</small>
        </div>
      `;
    });
  } catch (e) {
    list.innerHTML = '<div style="color:#d32f2f">Помилка завантаження</div>';
  }
}

</script>
</body>
</html>
